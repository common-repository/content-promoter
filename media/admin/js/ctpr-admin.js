var CTPR_Admin=function(){this.wizard=new CTPR_Wizard,this.pro=new CTPR_Pro,this.image_uploader=new CTPR_ImageUploader,this.wp_item_selector=new CTPR_WPItemSelector,this.color_picker=new CTPR_Colorpicker};document.addEventListener("DOMContentLoaded",function(){new CTPR_Admin}),function(){var s=/\s/g,a=/>/g,c=/</g;var l="__autosizeInputGhost";function d(){var t=document.createElement("div");return t.id=l,t.style.cssText="display:inline-block;height:0;overflow:hidden;position:absolute;top:0;visibility:hidden;white-space:nowrap;",document.body.appendChild(t),t}var u="";document.addEventListener("DOMContentLoaded",function(){u=d()}),window.autosizeInput=function(i,t){var e=window.getComputedStyle(i),r="box-sizing:"+e.boxSizing+";border-left:"+e.borderLeftWidth+" solid black;border-right:"+e.borderRightWidth+" solid black;font-family:"+e.fontFamily+";font-feature-settings:"+e.fontFeatureSettings+";font-kerning:"+e.fontKerning+";font-size:"+e.fontSize+";font-stretch:"+e.fontStretch+";font-style:"+e.fontStyle+";font-variant:"+e.fontVariant+";font-variant-caps:"+e.fontVariantCaps+";font-variant-ligatures:"+e.fontVariantLigatures+";font-variant-numeric:"+e.fontVariantNumeric+";font-weight:"+e.fontWeight+";letter-spacing:"+e.letterSpacing+";margin-left:"+e.marginLeft+";margin-right:"+e.marginRight+";padding-left:"+e.paddingLeft+";padding-right:"+e.paddingRight+";text-indent:"+e.textIndent+";text-transform:"+e.textTransform;function o(t){t=t||i.value||i.getAttribute("placeholder")||"",null===document.getElementById(l)&&(u=d()),u.style.cssText+=r,u.innerHTML=t.replace(s,"&nbsp;").replace(a,"&lt;").replace(c,"&gt;");var e=window.getComputedStyle(u).width;return i.style.width=e}i.addEventListener("input",function(){o()});var n=o();return t&&t.minWidth&&"0px"!==n&&(i.style.minWidth=n),o}}((window,document));var CTPR_DragManager=function(){function t(t,e){this.wizard=t,this.draggable_item=e.draggable_item,this.draggable_container=e.draggable_container}var e=t.prototype;return e.init=function(){if(this.canRun()){var e=this;new Sortable(document.querySelector(this.draggable_container),{animation:150,handle:this.draggable_item,onEnd:function(){var t=document.querySelectorAll(".ctpr-promoting-item-editor:not(.template)").length;e.wizard.updatePreviewer(t)}})}},e.canRun=function(){return!!document.querySelector(this.draggable_container)},t}(),CTPR_Pro=function(){function t(){this.handleModalOpen(),this.handleModalClose()}var e=t.prototype;return e.handleModalOpen=function(){document.addEventListener("click",function(t){var e=t.target.closest("[data-ctpr-pro-feature]");e&&(this.showPopup(e.dataset.ctprProFeature),t.preventDefault())}.bind(this))},e.handleModalClose=function(){document.querySelector(".ctpr-pro-modal-close")&&document.querySelector(".ctpr-pro-modal-close").addEventListener("click",function(t){t.target.closest(".ctpr-pro-modal-wrapper").classList.remove("is-visible"),t.preventDefault()})},e.showPopup=function(t){var e=document.querySelector(".ctpr-pro-modal-wrapper");e&&(e.querySelector(".feature-name").innerHTML=t,e.classList.add("is-visible"))},t}(),CTPR_Wizard=function(){function t(){this.nextID=1,this.init()}var e=t.prototype;return e.init=function(){this.initWPEditors(),this.setAutosizePromotingItemTitles(),this.calculateNextID(),this.initializePromotingItemsVisibility(),this.initializeSavedPage(),this.initItemsSelector(),this.handleStepClickEvent(),this.handleItemToggle(),this.handleItemTypeChange(),this.handleItemTypeButton(),this.handlePublishItemTypeChange(),this.handleFirstLastCheckboxOrdering(),this.handleNavigationOfNavigator(),this.handleSettingsModeSelector(),this.handleCopyToClipboard(),this.initializeDragManager()},e.initializeDragManager=function(){this.dragManager=new CTPR_DragManager(this,{draggable_item:".ctpr-move-promoting-item",draggable_container:".ctpr-promoting-items-wrapper"}),this.dragManager.init()},e.handleFirstLastCheckboxOrdering=function(){document.querySelector(".ctpr-set-first-item-appear-at-start")&&document.querySelector(".ctpr-set-first-item-appear-at-start").addEventListener("change",function(t){var e=document.querySelectorAll(".ctpr-previewer .promoting-item:not(.last-bottom)");if(0==e.length||1==e.length&&e[0].classList.contains("last-bottom"))return!1;t.target.checked?e[0].classList.add("first-top"):(document.querySelectorAll(".ctpr-previewer .promoting-item.first-top").forEach(function(t){t.classList.remove("first-top")}),1==e.length&&this.isLastCheckboxInSelectionChecked()&&e[0].classList.add("last-bottom"))}.bind(this)),document.querySelector(".ctpr-set-last-item-appear-at-end")&&document.querySelector(".ctpr-set-last-item-appear-at-end").addEventListener("change",function(t){var e=document.querySelectorAll(".ctpr-previewer .promoting-item:not(.first-top)");if(0==e.length||1==e.length&&e[0].classList.contains("first-top"))return!1;t.target.checked?e[e.length-1].classList.add("last-bottom"):(document.querySelectorAll(".ctpr-previewer .promoting-item.last-bottom").forEach(function(t){t.classList.remove("last-bottom")}),1==e.length&&this.isFirstCheckboxInSelectionChecked()&&e[0].classList.add("first-top"))}.bind(this))},e.handleSettingsModeSelector=function(){var t=document.querySelectorAll(".ctpr-publish-settings-mode-selector");if(t){var e=document.querySelector(".ctpr-publish-settings-replacement-element");e&&t.forEach(function(t){t.addEventListener("change",function(t){"auto"==t.target.value?e.classList.remove("ctpr-field-hidden"):e.classList.add("ctpr-field-hidden")})})}},e.handleCopyToClipboard=function(){document.addEventListener("click",function(t){var e=t.target.closest(".ctpr-copy-to-clipboard");if(e){var i=e.querySelector(".smart-tag").innerHTML;this.copyTextToClipboard(i);var r=e.querySelector(".ctpr-tooltiptext"),o=r.innerHTML;r.innerHTML=ctpr_js_object.SMART_TAG_COPIED_TO_CLIPBOARD,setTimeout(function(){r.innerHTML=o},1500),t.preventDefault()}}.bind(this))},e.initWPEditors=function(){var i=this;document.querySelectorAll(".ctpr-wpeditor-area").forEach(function(t){var e=t.getAttribute("id");i.initWPEditor(e)})},e.handlePublishItemTypeChange=function(){document.addEventListener("change",function(t){if(t.target.classList.contains("ctpr-publish-settings-item-type-selector")){var e=t.target.value,i=t.target.closest(".ctpr-publish-settings-item");"include"==e?(i.classList.remove("exclude"),i.classList.add("include")):"exclude"==e?(i.classList.remove("include"),i.classList.add("exclude")):(i.classList.remove("include"),i.classList.remove("exclude")),t.preventDefault()}}.bind(this))},e.setAutosizePromotingItemTitles=function(){var i,t=document.querySelectorAll(".ctpr-configure-screen .ctpr-promoting-item-editor:not(.template) .ctpr-item-title");if(t){var e=(i=0,function(t,e){clearTimeout(i),i=setTimeout(t,e)});t.forEach(function(t){t.classList.contains("autosize-init")||(t.classList.add("autosize-init"),autosizeInput(t),t.addEventListener("keyup",function(r){e(function(){var t=[].indexOf.call(r.target.closest(".ctpr-promoting-items-wrapper").children,r.target.closest(".ctpr-promoting-item-editor")),e=document.querySelector(".ctpr-previewer-navigator .items").children[t];e&&(e.querySelector(".title").innerHTML=r.target.value);var i=document.querySelectorAll(".ctpr-previewer .promoting-item");i&&(i[t].querySelector(".ctpr-sample-item-label").innerHTML=r.target.value)},150)}),t.addEventListener("blur",function(){this.value||(t.value=t.dataset.default_title,t.dispatchEvent(new Event("change")),t.dispatchEvent(new Event("input")))}))})}},e.handleNavigationOfNavigator=function(){document.addEventListener("click",function(t){var e=t.target.closest(".ctpr-previewer-navigator-item");if(e){var i=[].indexOf.call(e.closest(".items").children,e.closest(".ctpr-previewer-navigator-item")),r=document.querySelector(".ctpr-promoting-items-wrapper").children;if(r){var o=r[i];if(o){var n=o.getBoundingClientRect().top+window.pageYOffset-50;window.scrollTo({top:n,behavior:"smooth"})}t.preventDefault()}}})},e.calculateNextID=function(){var t=document.querySelectorAll(".ctpr-configure-screen .ctpr-promoting-items-wrapper .ctpr-promoting-item-editor");t&&t.length?this.nextID=t.length:this.nextID=1},e.initItemsSelector=function(){var t=document.querySelector(".ctpr-promoting-content-items-selector");t&&t.addEventListener("input",function(t){document.querySelector(".ctpr-promoting-content-items-number").innerHTML=t.target.value,this.resetPromotingItemClasses(),this.setTotalPromotingItemsToConfigure(t.target.value),this.updatePreviwerItemsBasedOnSelectionCheckboxes(),this.updatePreviewer(t.target.value)}.bind(this))},e.updatePreviwerItemsBasedOnSelectionCheckboxes=function(){var t=document.querySelectorAll(".ctpr-previewer .promoting-item");this.isFirstCheckboxInSelectionChecked()&&t[0].classList.add("first-top"),this.isLastCheckboxInSelectionChecked()&&1<t.length&&t[t.length-1].classList.add("last-bottom")},e.isFirstCheckboxInSelectionChecked=function(){return!!document.querySelector(".ctpr-set-first-item-appear-at-start")&&document.querySelector(".ctpr-set-first-item-appear-at-start").checked},e.isLastCheckboxInSelectionChecked=function(){return!!document.querySelector(".ctpr-set-last-item-appear-at-end")&&document.querySelector(".ctpr-set-last-item-appear-at-end").checked},e.resetPromotingItemClasses=function(){document.querySelectorAll(".ctpr-previewer .promoting-item").forEach(function(t){t.classList.remove("first-top"),t.classList.remove("last-bottom")})},e.handleItemTypeChange=function(){document.addEventListener("click",function(t){var e=t.target.closest(".ctpr-change-type-promoting-item");if(e){var i=e.closest(".ctpr-promoting-item-editor"),r=this.findPromotingItem(i);e.classList.contains("is-active")?(e.classList.remove("is-active"),i.querySelector(".body .content").classList.remove("is-hidden"),""==i.querySelector(".body .content").innerHTML.trim()&&(i.classList.remove("is-active"),r.classList.add("dashicons-arrow-down-alt2"),r.classList.remove("dashicons-arrow-up-alt2")),i.querySelector(".body > .ctpr-content-chooser").classList.remove("is-visible")):(e.classList.add("is-active"),i.classList.contains("is-active")||i.classList.add("is-active"),r.classList.contains("dashicons-arrow-down-alt2")&&(r.classList.add("dashicons-arrow-up-alt2"),r.classList.remove("dashicons-arrow-down-alt2")),i.querySelector(".body .content").classList.add("is-hidden"),i.querySelector(".body > .ctpr-content-chooser").classList.add("is-visible")),t.preventDefault()}}.bind(this))},e.findPromotingItem=function(t){var e=".ctpr-toggle-promoting-item";return t.closest(e)?t.closest(e):t.querySelector(e)},e.findPromotingItemEditor=function(t){var e=".ctpr-promoting-item-editor";return t.closest(e)?t.closest(e):t.querySelector(e)},e.handleItemTypeButton=function(){document.addEventListener("click",function(t){var e=t.target.closest(".item:not(.pro)");if(e&&e.closest(".ctpr-content-chooser")){e.classList.add("disabled");var i=e.getAttribute("data-type"),r=e.closest(".ctpr-content-chooser-field");r&&(r.querySelector('input[type="hidden"]').value=i);var o=e.closest(".ctpr-promoting-item-editor"),n=this;this.showConfigureLoader(e);var s=o.querySelector('input[type="hidden"].item_type').getAttribute("data-id")||1,a=new FormData;a.append("nonce",ctpr_js_object.nonce),a.append("action","ctpr_type_change"),a.append("type",i),a.append("item_id",s),fetch(ctpr_js_object.ajax_url,{method:"POST",body:a}).then(function(t){return e.classList.remove("disabled"),n.hideConfigureLoader(e),t.json()}).then(function(t){t.error?alert(t.data):(o.querySelector(".ctpr-content-chooser .item.is-active")&&o.querySelector(".ctpr-content-chooser .item.is-active").classList.remove("is-active"),e.classList.add("is-active"),n.hidePromotingItemTypeChooser(e),n.updatePromotingItemBody(e,t.data),n.updatePromotingItemType(i,s),new CTPR_Colorpicker)}).catch(function(t){console.log(t)}),t.preventDefault()}}.bind(this))},e.hidePromotingItemTypeChooser=function(t){var e=t.closest(".ctpr-promoting-item-editor");e.querySelector(".body > .ctpr-content-chooser").classList.remove("is-visible"),e.querySelector(".ctpr-change-type-promoting-item").classList.remove("is-active")},e.updatePromotingItemBody=function(t,e){var i=t.closest(".ctpr-promoting-item-editor");i.querySelector(".body .content").innerHTML=e,i.querySelector(".body .content").classList.remove("is-hidden"),this.fixNames(i),this.findPromotingItem(i).classList.add("dashicons-arrow-up-alt2"),this.findPromotingItem(i).classList.remove("dashicons-arrow-down-alt2")},e.fixNames=function(t){var i=this;t.querySelectorAll("[name]").forEach(function(t){var e=t.getAttribute("name");e=e.replace("[ITEM_ID]","["+i.nextID+"]"),t.setAttribute("name",e)})},e.updatePromotingItemType=function(t,e){var i=document.querySelector('input[type="hidden"].item_type[data-id="'+e+'"]').closest(".ctpr-promoting-item-editor");if(i&&(i.querySelector('input[type="hidden"].item_type').value=t,i.querySelector('input[type="hidden"].item_type').setAttribute("data-id",e),"Text"==t)){var r=i.querySelector(".ctpr-wpeditor-area").getAttribute("id");this.initWPEditor(r)}},e.initWPEditor=function(t){var e=document.querySelector("#"+t),i=JSON.parse(e.getAttribute("data-tinymce-configs"));wp.editor.remove(t),wp.editor.initialize(t,i)},e.showConfigureLoader=function(t){t.closest(".ctpr-promoting-item-editor").querySelector(".ctpr-item-loader").classList.add("is-active")},e.hideConfigureLoader=function(t){t.closest(".ctpr-promoting-item-editor").querySelector(".ctpr-item-loader").classList.remove("is-active")},e.updatePreviewer=function(t){t=parseInt(t);var e=document.querySelector(".ctpr-previewer");e.querySelectorAll(".promoting-item").forEach(function(t){t.remove()});for(var i=e.querySelectorAll(".item").length,r=Math.round(i/(t+1)),o=r,n=1;n<=t;n++){var s=e.querySelector(".item:nth-child("+r+")");if(!s)break;var a=document.querySelector(".promoting-item-template").cloneNode(!0);a.querySelector(".cptr-sample-promoting-item-number").innerHTML=n,a.classList.remove("promoting-item-template"),s.parentNode.insertBefore(a,s.nextSibling),r+=o}e=document.querySelector(".ctpr-previewer");var c=document.querySelectorAll(".ctpr-promoting-item-editor:not(.template)"),l=0;e.querySelectorAll(".promoting-item").forEach(function(t){c[l]&&t.querySelector(".ctpr-sample-item-label")&&(t.querySelector(".ctpr-sample-item-label").innerHTML=c[l].querySelector(".ctpr-item-title").value,l++)})},e.setTotalPromotingItemsToConfigure=function(t){var e=document.querySelector(".ctpr-configure-screen"),i=e.querySelectorAll(".ctpr-promoting-items-wrapper .ctpr-promoting-item-editor"),r=document.querySelectorAll(".ctpr-previewer-navigator .items .ctpr-previewer-navigator-item");if(i.length>t)for(var o=i.length-t,n=0,s=0;s<o;s++)i[i.length-1-n]&&i[i.length-1-n].remove(),r[i.length-1-n]&&r[i.length-1-n].remove(),n++;else{this.nextID=this.nextID+1;var a=e.querySelector(".ctpr-promoting-item-editor.template").cloneNode(!0);a.classList.remove("template"),a.setAttribute("data-item-id",this.nextID),a.querySelector(".number span").innerHTML=t;var c=a.querySelector(".top .ctpr-item-title").getAttribute("name");c=c.replace("[ITEM_ID]","["+this.nextID+"]"),a.querySelector(".top .ctpr-item-title").setAttribute("name",c);var l=a.querySelector(".item_type").getAttribute("name");l=l.replace("[ITEM_ID]","["+this.nextID+"]"),a.querySelector(".item_type").setAttribute("name",l),a.querySelector(".item_type").setAttribute("data-id",this.nextID),e.querySelector(".ctpr-promoting-items-wrapper").appendChild(a);var d=document.querySelector(".ctpr-previewer-navigator-item.template").cloneNode(!0);d.classList.remove("template"),document.querySelector(".ctpr-previewer-navigator .items").appendChild(d),this.setAutosizePromotingItemTitles()}},e.handleStepClickEvent=function(){document.addEventListener("click",function(t){var e=t.target;if(e.classList.contains("step-button")&&!e.classList.contains("save-button")){var i=e.getAttribute("data-page"),r=e.getAttribute("data-button");this.showPage(r,i),t.preventDefault()}}.bind(this))},e.hideCurrentPageAndRelatives=function(){document.querySelector(".ctpr-wizard .wizard-pages .page.is-active").classList.remove("is-active"),document.querySelector(".ctpr-wizard .wizard-nav li.is-active").classList.remove("is-active")},e.showPage=function(t,e,i){this.swapRequiredSelectionPageItems(t,e,i),this.hideCurrentPageAndRelatives(),document.querySelector('.ctpr-wizard .wizard-pages .page[data-page="'+e+'"]').classList.add("is-active"),document.querySelector('.ctpr-wizard .wizard-nav li[data-page="'+e+'"]').classList.add("is-active"),this.saveSelectedPage(e),this.afterPageAppears(e)},e.saveSelectedPage=function(t){var e=window.location.search,i=new URLSearchParams(e).get("post");if(i&&t){var r="ctpr_"+i+"_current_page";localStorage.setItem(r,t)}},e.initializeSavedPage=function(){var t=window.location.search,e=new URLSearchParams(t).get("post");if(e){var i="ctpr_"+e+"_current_page",r=localStorage.getItem(i)||!1;r&&this.showPage("next",r,!0)}},e.afterPageAppears=function(t){var e=document.querySelector(".ctpr-previewer-navigator"),i=this.getWizardActions().querySelector('button[data-button="next"]');"configure"==t?e&&e.classList.add("is-visible"):e&&e.classList.remove("is-visible"),"publish"==t?(i.setAttribute("name","save"),i.setAttribute("value","update"),i.setAttribute("type","submit"),i.classList.add("save-button")):(i.removeAttribute("name"),i.removeAttribute("value"),i.removeAttribute("type"),i.classList.remove("save-button"))},e.getWizardActions=function(){return document.querySelector(".ctpr-wizard .wizard-actions")},e.swapRequiredSelectionPageItems=function(t,e,i){i&&"selection"==e&&(t="prev");var r=this.getNewPageData(t,e);if(r){i&&("selection"!=e&&(r.prevButtonSelector="selection"),r.nextButtonSelector="configure");var o=document.querySelector('.ctpr-wizard .wizard-actions .step-button[data-page="'+r.prevButtonSelector+'"]'),n=document.querySelector('.ctpr-wizard .wizard-actions .step-button[data-page="'+r.nextButtonSelector+'"]');o.innerHTML=r.prevButton,o.setAttribute("data-page",r.prevButtonAtt),r.prevButtonDisabled?o.classList.add("is-disabled"):o.classList.remove("is-disabled"),n.innerHTML=r.nextButton,n.setAttribute("data-page",r.nextButtonAtt),r.nextButtonDisabled?n.classList.add("is-disabled"):n.classList.remove("is-disabled")}},e.handleItemToggle=function(){document.addEventListener("click",function(t){if(t.target.closest(".ctpr-toggle-promoting-item")){var e=t.target,i=this.findPromotingItemEditor(e),r="";i.classList.contains("is-active")?(r="hidden",this.hidePromotingItem(i)):(r="show",this.showPromotingItem(i)),this.setPromotingItemVisibilityStatus(i,r),t.preventDefault()}}.bind(this))},e.showPromotingItem=function(t){var e=t.querySelector(".ctpr-toggle-promoting-item");e.classList.add("dashicons-arrow-up-alt2"),e.classList.remove("dashicons-arrow-down-alt2"),t.classList.add("is-active"),""==t.querySelector(".body .content").innerHTML.trim()&&(t.querySelector(".ctpr-change-type-promoting-item").classList.add("is-active"),t.querySelector(".body .content").classList.add("is-hidden"),t.querySelector(".body > .ctpr-content-chooser").classList.add("is-visible"))},e.hidePromotingItem=function(t){var e=t.querySelector(".ctpr-toggle-promoting-item");t.classList.remove("is-active"),e.classList.remove("dashicons-arrow-up-alt2"),e.classList.add("dashicons-arrow-down-alt2"),t.querySelector(".ctpr-change-type-promoting-item").classList.remove("is-active"),t.querySelector(".body .content").classList.remove("is-hidden"),t.querySelector(".body > .ctpr-content-chooser").classList.remove("is-visible")},e.setPromotingItemVisibilityStatus=function(t,e){var i=window.location.search,r=new URLSearchParams(i).get("post");if(r){var o=t.querySelector('input[type="hidden"].item_type').getAttribute("data-id");if(o){var n="ctpr_"+r+"_promoting_items",s=JSON.parse(localStorage.getItem(n))||{};s[o]=e,localStorage.setItem(n,JSON.stringify(s))}}},e.initializePromotingItemsVisibility=function(){var t=window.location.search,e=new URLSearchParams(t).get("post");if(e){var i="ctpr_"+e+"_promoting_items",r=JSON.parse(localStorage.getItem(i))||{};if(r)for(var o in r){var n=o,s=r[o],a=document.querySelector('.ctpr-promoting-item-editor input[type="hidden"][data-id="'+n+'"]');a&&(a=a.closest(".ctpr-promoting-item-editor"),"show"==s?this.showPromotingItem(a):this.hidePromotingItem(a))}}},e.getNewPageData=function(t,e){var i=[];return i.prevButtonDisabled=!1,i.nextButtonDisabled=!1,"next"==t?"configure"==e?(i.prevButtonSelector="selection",i.prevButtonAtt="selection",i.prevButton=ctpr_js_object.SELECTION,i.nextButtonSelector="configure",i.nextButtonAtt="publish",i.nextButton=ctpr_js_object.PUBLISH_SETTINGS):"publish"==e&&(i.prevButtonSelector="selection",i.prevButtonAtt="configure",i.prevButton=ctpr_js_object.CONFIGURE,i.nextButtonSelector="publish",i.nextButtonAtt="publish",i.nextButton=ctpr_js_object.SAVE):"selection"==e?(i.prevButtonSelector="selection",i.prevButtonAtt="selection",i.prevButton=ctpr_js_object.SELECTION,i.prevButtonDisabled=!0,i.nextButtonSelector="publish",i.nextButtonAtt="configure",i.nextButton=ctpr_js_object.CONFIGURE):"configure"==e&&(i.prevButtonSelector="configure",i.prevButtonAtt="selection",i.prevButton=ctpr_js_object.SELECTION,i.nextButtonSelector="publish",i.nextButtonAtt="publish",i.nextButton=ctpr_js_object.PUBLISH_SETTINGS),i},e.getCurrentPage=function(){return document.querySelector(".ctpr-wizard .wizard-nav li.is-active").getAttribute("data-page")},e.copyTextToClipboard=function(t){if(window.clipboardData&&window.clipboardData.setData)return clipboardData.setData("Text",t);if(document.queryCommandSupported&&document.queryCommandSupported("copy")){var e=document.createElement("textarea");e.textContent=t,e.style.position="fixed",document.body.appendChild(e),e.select();try{return document.execCommand("copy")}catch(t){return console.warn("Copy to clipboard failed.",t),!1}finally{document.body.removeChild(e)}}},t}(),CTPR_Colorpicker=function(){function t(){this.init()}return t.prototype.init=function(){document.querySelectorAll(".ctpr-color-picker-input:not(.rendered)").forEach(function(t){jQuery(t).wpColorPicker(),t.classList.add("rendered")})},t}(),CTPR_ImageUploader=function(){function t(){this.init()}var e=t.prototype;return e.init=function(){this.initAddButton(),this.initRemoveButton()},e.initAddButton=function(){document.addEventListener("click",function(t){var i=t.target.closest(".ctpr-image-upload-browse");if(i){var r=wp.media({title:"Insert image",library:{type:"image"},button:{text:"Use this image"},multiple:!1}).on("select",function(){var t=r.state().get("selection").first().toJSON(),e=i.closest(".ctpr-image-upload-wrapper");e.querySelector('input[type="hidden"]').value=t.url,e.querySelector(".ctpr-image-upload-reset").classList.add("is-visible"),e.querySelector(".ctpr-image-upload-preview img").setAttribute("src",t.url),e.querySelector(".ctpr-image-upload-preview").classList.add("is-visible")}).open();t.preventDefault()}})},e.initRemoveButton=function(){document.addEventListener("click",function(t){var e=t.target.closest(".ctpr-image-upload-reset");if(e){var i=e.closest(".ctpr-image-upload-wrapper");i.querySelector('input[type="hidden"]').value="",i.querySelector(".ctpr-image-upload-reset").classList.remove("is-visible"),i.querySelector(".ctpr-image-upload-preview img").setAttribute("src",""),i.querySelector(".ctpr-image-upload-preview").classList.remove("is-visible"),t.preventDefault()}})},t}(),CTPR_WPItemSelector=function(){function t(){this.wrapper=".ctpr-wp-item-selector-wrapper",this.inputClass="ctpr-wp-item-selector-input",this.resultsClass=".ctpr-wp-item-selector-results",this.init()}var e=t.prototype;return e.init=function(){this.setInputEventListener(),this.setupResultsClose(),this.setupResultsItemEventListener(),this.setupResultsItemRemoveEventListener()},e.setInputEventListener=function(){var i,r=this,t=(i=0,function(t,e){clearTimeout(i),i=setTimeout(t,e)});document.addEventListener("keyup",function(i){i.target.classList.contains(this.inputClass)&&t(function(){var t=i.target,e=t.getAttribute("data-type");r.searchForData(t,e)},350)}.bind(this))},e.setupResultsItemEventListener=function(){document.addEventListener("click",function(t){if(t.target.closest(this.resultsClass)){var e=t.target.closest(".item");if(!e)return!1;if(e.getAttribute("data-id")){var i=e.cloneNode(!0),r=t.target.closest(this.wrapper).querySelector(".selected-items");r.appendChild(i),r.classList.add("is-visible"),t.target.closest(this.wrapper).querySelector("."+this.inputClass).value="",this.emptyAndHideResults(),t.preventDefault()}}}.bind(this))},e.setupResultsItemRemoveEventListener=function(){document.addEventListener("click",function(t){if(t.target.closest(".ctpr-wp-item-selector-remove-selected-item")){var e=t.target.closest(this.wrapper).querySelector(".selected-items");t.target.closest(".item").remove(),""==e.innerHTML.trim()&&e.classList.remove("is-visible"),t.preventDefault()}}.bind(this))},e.setupResultsClose=function(){document.addEventListener("click",function(t){t.target.closest(this.resultsClass)||this.emptyAndHideResults()}.bind(this))},e.emptyAndHideResults=function(){document.querySelectorAll(this.resultsClass).forEach(function(t){t.innerHTML="",t.classList.remove("is-visible")})},e.searchForData=function(i,t){var r=this;i.classList.add("disabled"),r.showLoader(i);var e=i.getAttribute("data-name"),o=this.findAlreadySelectedItems(i),n=new FormData;n.append("nonce",ctpr_js_object.nonce),n.append("action","ctpr_get_wp_item_selector_data"),n.append("name",e),n.append("type",t),n.append("q",i.value),n.append("no_ids",o),fetch(ctpr_js_object.ajax_url,{method:"POST",body:n}).then(function(t){return i.classList.remove("disabled"),r.hideLoader(i),t.json()}).then(function(t){var e=i.closest(r.wrapper).querySelector(r.resultsClass);e.innerHTML=t.data,e.classList.add("is-visible")}).catch(function(t){console.log(t)})},e.findAlreadySelectedItems=function(t){var e=t.closest(this.wrapper).querySelectorAll(".selected-items.is-visible .item"),i=[];return e.forEach(function(t){var e=t.querySelector('input[type="hidden"]').value;i.push(e)}),i},e.showLoader=function(t){t.closest(this.wrapper).querySelector(".ctpr-item-loader").classList.add("is-active")},e.hideLoader=function(t){t.closest(this.wrapper).querySelector(".ctpr-item-loader").classList.remove("is-active")},t}();
